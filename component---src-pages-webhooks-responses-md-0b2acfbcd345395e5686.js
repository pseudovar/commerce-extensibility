"use strict";(self.webpackChunkcommerce_extensibility=self.webpackChunkcommerce_extensibility||[]).push([[4424],{74842:function(e,t,n){n.r(t),n.d(t,{_frontmatter:function(){return o},default:function(){return s}});var a=n(87462),d=n(45987),r=(n(35776),n(3905)),l=n(91515);const m=["components"],o={},i={_frontmatter:o},p=l.Z;function s(e){let{components:t}=e,n=(0,d.Z)(e,m);return(0,r.mdx)(p,(0,a.Z)({},i,n,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("h1",{id:"webhook-responses-and-logging"},"Webhook responses and logging"),(0,r.mdx)("p",null,"Currently, Adobe Commerce webhooks support responses in JSON format only. The response may be a single operation or an array of operations to be executed afterward.\nEach operation must contain some required fields based on the desired operation."),(0,r.mdx)("p",null,"Exceptions and notices are logged in the ",(0,r.mdx)("inlineCode",{parentName:"p"},"<installation_directory>/var/log/system.log")," file."),(0,r.mdx)("h2",{id:"responses"},"Responses"),(0,r.mdx)("p",null,"The endpoint is expected to return a ",(0,r.mdx)("inlineCode",{parentName:"p"},"200")," response and a JSON object or array of objects that indicates the result of the operation. Each operation object can contain the list of fields based on the operation (",(0,r.mdx)("inlineCode",{parentName:"p"},"op"),") which should be performed."),(0,r.mdx)("p",null,"Adobe Commerce webhooks support the following operations:"),(0,r.mdx)("table",null,(0,r.mdx)("thead",{parentName:"table"},(0,r.mdx)("tr",{parentName:"thead"},(0,r.mdx)("th",{parentName:"tr",align:null},"Operation"),(0,r.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,r.mdx)("tbody",{parentName:"table"},(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"success")),(0,r.mdx)("td",{parentName:"tr",align:null},"The process that triggered the original event continues without any changes.")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"exception")),(0,r.mdx)("td",{parentName:"tr",align:null},"Causes Commerce to terminate the process that triggered the original event.")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"add")),(0,r.mdx)("td",{parentName:"tr",align:null},"Updates the arguments in the original event by adding data described in the operation")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"replace")),(0,r.mdx)("td",{parentName:"tr",align:null},"Replaces argument values in the original event, based on the response.")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"remove")),(0,r.mdx)("td",{parentName:"tr",align:null},"Removes values or nodes from the arguments in the original event by the provided path")))),(0,r.mdx)("h3",{id:"success-operation"},"Success operation"),(0,r.mdx)("p",null,"The ",(0,r.mdx)("inlineCode",{parentName:"p"},"success")," operation is returned when changes are not needed. The process that triggered the original event continues without any changes."),(0,r.mdx)("p",null,"The response of a successful request is as follows:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "op": "success"\n}\n')),(0,r.mdx)("h3",{id:"exception-operation"},"Exception operation"),(0,r.mdx)("p",null,"The ",(0,r.mdx)("inlineCode",{parentName:"p"},"exception")," operation causes Commerce to terminate the process that triggered the original event. The exception is logged in ",(0,r.mdx)("inlineCode",{parentName:"p"},"<installation_directory>/var/log/system.log"),"."),(0,r.mdx)("table",null,(0,r.mdx)("thead",{parentName:"table"},(0,r.mdx)("tr",{parentName:"thead"},(0,r.mdx)("th",{parentName:"tr",align:null},"Field"),(0,r.mdx)("th",{parentName:"tr",align:null},"Type"),(0,r.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,r.mdx)("tbody",{parentName:"table"},(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"op")),(0,r.mdx)("td",{parentName:"tr",align:null},"Required"),(0,r.mdx)("td",{parentName:"tr",align:null},"Contains ",(0,r.mdx)("inlineCode",{parentName:"td"},"exception"),".")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"class")),(0,r.mdx)("td",{parentName:"tr",align:null},"Optional"),(0,r.mdx)("td",{parentName:"tr",align:null},"Specifies the exception class. If ",(0,r.mdx)("inlineCode",{parentName:"td"},"class")," is not set, ",(0,r.mdx)("inlineCode",{parentName:"td"},"\\Magento\\Framework\\Exception\\LocalizedException")," will be thrown.")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"message")),(0,r.mdx)("td",{parentName:"tr",align:null},"Optional"),(0,r.mdx)("td",{parentName:"tr",align:null},"Specifies the exception message. If this field is not explicitly set, then the message defined in the ",(0,r.mdx)("inlineCode",{parentName:"td"},"fallbackErrorMessage")," configuration field will be returned. If ",(0,r.mdx)("inlineCode",{parentName:"td"},"fallbackErrorMessage")," is not set, the system default error message will be returned.")))),(0,r.mdx)("p",null,"If an error occurs, the response is similar to the following:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "op": "exception",\n  "class": "Path\\\\To\\\\Exception\\\\Class",\n  "message": "The product cannot be added to the cart because it is out of the stock"\n}\n')),(0,r.mdx)("h3",{id:"add-operation"},"Add operation"),(0,r.mdx)("p",null,"The ",(0,r.mdx)("inlineCode",{parentName:"p"},"add")," operation causes Commerce to add the provided ",(0,r.mdx)("inlineCode",{parentName:"p"},"value")," to the provided ",(0,r.mdx)("inlineCode",{parentName:"p"},"path")," to the triggered event arguments"),(0,r.mdx)("table",null,(0,r.mdx)("thead",{parentName:"table"},(0,r.mdx)("tr",{parentName:"thead"},(0,r.mdx)("th",{parentName:"tr",align:null},"Field"),(0,r.mdx)("th",{parentName:"tr",align:null},"Type"),(0,r.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,r.mdx)("tbody",{parentName:"table"},(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"op")),(0,r.mdx)("td",{parentName:"tr",align:null},"Required"),(0,r.mdx)("td",{parentName:"tr",align:null},"Contains ",(0,r.mdx)("inlineCode",{parentName:"td"},"add"),".")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"path")),(0,r.mdx)("td",{parentName:"tr",align:null},"Required"),(0,r.mdx)("td",{parentName:"tr",align:null},"Specifies the path at which the ",(0,r.mdx)("inlineCode",{parentName:"td"},"value")," should be added to the triggered event arguments.")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"value")),(0,r.mdx)("td",{parentName:"tr",align:null},"Required"),(0,r.mdx)("td",{parentName:"tr",align:null},"Specifies the value to be added. This can be as a single value or in an array format.")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"instance")),(0,r.mdx)("td",{parentName:"tr",align:null},"Optional"),(0,r.mdx)("td",{parentName:"tr",align:null},"Specifies the ",(0,r.mdx)("inlineCode",{parentName:"td"},"DataObject")," class name to create, based on the  ",(0,r.mdx)("inlineCode",{parentName:"td"},"value")," and added to the provided ",(0,r.mdx)("inlineCode",{parentName:"td"},"path"),". Use this field for cases when the object should be added in provided path.")))),(0,r.mdx)("p",null,"For example, we want to add a new shipping method to the triggered event result payload.\nThe result is an array of ",(0,r.mdx)("inlineCode",{parentName:"p"},"Magento\\Quote\\Model\\Cart\\ShippingMethod")," objects:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-php"},"$result = [\n    0 => {Magento\\Quote\\Model\\Cart\\ShippingMethodInterface},\n    1 => {Magento\\Quote\\Model\\Cart\\ShippingMethodInterface}\n];\n")),(0,r.mdx)("p",null,"To add a new shipping method to that result, the response from the webhook would look like:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "op": "add",\n  "path": "result",\n  "value": {\n    "data": {\n      "amount": "5",\n      "base_amount": "5",\n      "carrier_code": "newshipmethod",\n      "carrier_title": "Webhook new shipping method",\n    }\n  },\n  "instance": "Magento\\\\Quote\\\\Api\\\\Data\\\\ShippingMethodInterface"\n}\n')),(0,r.mdx)("p",null,"Based on this operation, the new instance of ",(0,r.mdx)("inlineCode",{parentName:"p"},"Magento\\Quote\\Model\\Cart\\ShippingMethodInterface")," will be created and added to the result array of shipping methods."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-php"},"$result = [\n    0 => {Magento\\Quote\\Model\\Cart\\ShippingMethodInterface},\n    1 => {Magento\\Quote\\Model\\Cart\\ShippingMethodInterface},\n    2 => {Magento\\Quote\\Model\\Cart\\ShippingMethodInterface}\n];\n")),(0,r.mdx)("h3",{id:"replace-operation"},"Replace operation"),(0,r.mdx)("p",null,"The ",(0,r.mdx)("inlineCode",{parentName:"p"},"replace")," operation causes Commerce to replace a value in triggered event arguments for the provided ",(0,r.mdx)("inlineCode",{parentName:"p"},"path")),(0,r.mdx)("table",null,(0,r.mdx)("thead",{parentName:"table"},(0,r.mdx)("tr",{parentName:"thead"},(0,r.mdx)("th",{parentName:"tr",align:null},"Field"),(0,r.mdx)("th",{parentName:"tr",align:null},"Type"),(0,r.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,r.mdx)("tbody",{parentName:"table"},(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"op")),(0,r.mdx)("td",{parentName:"tr",align:null},"Required"),(0,r.mdx)("td",{parentName:"tr",align:null},"Contains ",(0,r.mdx)("inlineCode",{parentName:"td"},"replace"),".")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"path")),(0,r.mdx)("td",{parentName:"tr",align:null},"Required"),(0,r.mdx)("td",{parentName:"tr",align:null},"Specifies the path at which the value should be replaced with the provided ",(0,r.mdx)("inlineCode",{parentName:"td"},"value"),".")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"value")),(0,r.mdx)("td",{parentName:"tr",align:null},"Required"),(0,r.mdx)("td",{parentName:"tr",align:null},"Specifies the replacement value. This can be as a single value or in an array format.")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"instance")),(0,r.mdx)("td",{parentName:"tr",align:null},"Optional"),(0,r.mdx)("td",{parentName:"tr",align:null},"Specifies the ",(0,r.mdx)("inlineCode",{parentName:"td"},"DataObject")," class name to create, based on the  ",(0,r.mdx)("inlineCode",{parentName:"td"},"value")," and added to the provided ",(0,r.mdx)("inlineCode",{parentName:"td"},"path"),".")))),(0,r.mdx)("p",null,"The following example replaces a nested element in the triggered event result payload:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-php"},"$result = [\n    'shipping_methods' => [\n        'shipping_method_one' => [\n            'amount' => 5\n        ]           \n    ]   \n];\n")),(0,r.mdx)("p",null,"The response from the webhook endpoint:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "op": "replace",\n  "path": "result/shipping_methods/shipping_method_one/amount",\n  "value": 6\n}\n')),(0,r.mdx)("p",null,"The updated result will be modified to:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-php"},"$result = [\n    'shipping_methods' => [\n        'shipping_method_one' => [\n            'amount' => 6\n        ]           \n    ]   \n];\n")),(0,r.mdx)("h3",{id:"remove-operation"},"Remove operation"),(0,r.mdx)("p",null,"The ",(0,r.mdx)("inlineCode",{parentName:"p"},"remove")," operation causes Commerce to remove a value or node in triggered event arguments by the provided ",(0,r.mdx)("inlineCode",{parentName:"p"},"path")),(0,r.mdx)("table",null,(0,r.mdx)("thead",{parentName:"table"},(0,r.mdx)("tr",{parentName:"thead"},(0,r.mdx)("th",{parentName:"tr",align:null},"Field"),(0,r.mdx)("th",{parentName:"tr",align:null},"Type"),(0,r.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,r.mdx)("tbody",{parentName:"table"},(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"op")),(0,r.mdx)("td",{parentName:"tr",align:null},"Required"),(0,r.mdx)("td",{parentName:"tr",align:null},"Contains ",(0,r.mdx)("inlineCode",{parentName:"td"},"remove"),".")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"path")),(0,r.mdx)("td",{parentName:"tr",align:null},"Required"),(0,r.mdx)("td",{parentName:"tr",align:null},"Specifies the path at which the value should be removed.")))),(0,r.mdx)("p",null,"The following example removes element ",(0,r.mdx)("inlineCode",{parentName:"p"},"key2")," from the triggered event result payload:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-php"},"$result = [\n    'key1' => 'value1', \n    'key2' => 'value2', \n    'key3' => 'value3', \n];\n")),(0,r.mdx)("p",null,"The response from the webhook endpoint:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "op": "remove",\n  "path": "result/key2"\n}\n')),(0,r.mdx)("p",null,"The updated result will be modified to:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-php"},"$result = [\n    'key1' => 'value1', \n    'key3' => 'value3', \n];\n")),(0,r.mdx)("h2",{id:"logging"},"Logging"),(0,r.mdx)("p",null,"The following table describes webhook logging activity. Each hook can be configured to have its own soft and hard timeout values."),(0,r.mdx)("table",null,(0,r.mdx)("thead",{parentName:"table"},(0,r.mdx)("tr",{parentName:"thead"},(0,r.mdx)("th",{parentName:"tr",align:null},"Case"),(0,r.mdx)("th",{parentName:"tr",align:null},"Logging activity"))),(0,r.mdx)("tbody",{parentName:"table"},(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},"A hook was executed within the soft and hard time limits with a 2xx response code."),(0,r.mdx)("td",{parentName:"tr",align:null},"None")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},"An optional hook was executed with a response code other than 2xx within the soft and hard time limits."),(0,r.mdx)("td",{parentName:"tr",align:null},"Add error log entry")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},"A required hook was executed with a response code other than 2xx within the soft and hard time limits."),(0,r.mdx)("td",{parentName:"tr",align:null},"Add error log entry",(0,r.mdx)("br",null),"Throw an exception")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},"An optional hook is aborted due to reaching the hard timeout limit."),(0,r.mdx)("td",{parentName:"tr",align:null},"Add error log entry")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},"A required hook is aborted due to reaching the hard timeout limit."),(0,r.mdx)("td",{parentName:"tr",align:null},"Add error log entry",(0,r.mdx)("br",null),"Throw an exception")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},"The execution time of hook exceeds the soft timeout limit."),(0,r.mdx)("td",{parentName:"tr",align:null},"Add a notice to the error log")))))}s.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-webhooks-responses-md-0b2acfbcd345395e5686.js.map