"use strict";(self.webpackChunkcommerce_extensibility=self.webpackChunkcommerce_extensibility||[]).push([[6199],{4235:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return o},default:function(){return p}});var a=t(87462),i=t(45987),l=(t(35776),t(3905)),r=t(91515);const d=["components"],o={},m={_frontmatter:o},s=r.Z;function p(e){let{components:n}=e,t=(0,i.Z)(e,d);return(0,l.mdx)(s,(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,l.mdx)("h1",{id:"convert-payload-field-values"},"Convert payload field values"),(0,l.mdx)("p",null,"The payload of an event often includes field values that are not easily interpretable for third-party implementations. For example, a value might be stored in the Commerce database as an integer, but the external system stores the same information as a string. Alternatively, instead of transforming data types, you might want to change a Commerce-supplied string to a string defined in the external system. To address this issue, you can implement a converter, enabling custom values for any field in the payload."),(0,l.mdx)("h2",{id:"converter-definition"},"Converter definition"),(0,l.mdx)("p",null,"Your converter class must implement ",(0,l.mdx)("inlineCode",{parentName:"p"},"FieldConverterInterface"),". This interface contains the ",(0,l.mdx)("inlineCode",{parentName:"p"},"convert")," method, which accepts ",(0,l.mdx)("inlineCode",{parentName:"p"},"mixed")," and ",(0,l.mdx)("inlineCode",{parentName:"p"},"Event")," arguments. The method returns a ",(0,l.mdx)("inlineCode",{parentName:"p"},"mixed")," data type. You must create individual converter classes for each field when converting multiple fields within a payload. You can reuse a class to replace a specific field across multiple events."),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-php"},"interface FieldConverterInterface\n{\n    /**\n     * Converts a field value\n     *\n     * @param mixed $value\n     * @param Event $event\n     * @return mixed\n     */\n    public function convert(mixed $value, Event $event);\n}\n")),(0,l.mdx)("p",null,"As an example, the ",(0,l.mdx)("inlineCode",{parentName:"p"},"observer.catalog_product_save_after")," event contains a top-level ",(0,l.mdx)("inlineCode",{parentName:"p"},"visibility")," field, which must contain an integer value. Convert these values to strings that match values on the external system. The following table describes these values."),(0,l.mdx)("table",null,(0,l.mdx)("thead",{parentName:"table"},(0,l.mdx)("tr",{parentName:"thead"},(0,l.mdx)("th",{parentName:"tr",align:null},"Commerce value"),(0,l.mdx)("th",{parentName:"tr",align:null},"Converted value"),(0,l.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,l.mdx)("tbody",{parentName:"table"},(0,l.mdx)("tr",{parentName:"tbody"},(0,l.mdx)("td",{parentName:"tr",align:null},"1"),(0,l.mdx)("td",{parentName:"tr",align:null},"NOT_VISIBLE_INDIVIDUALLY"),(0,l.mdx)("td",{parentName:"tr",align:null},"This product should not be displayed if it is part of a configurable product.")),(0,l.mdx)("tr",{parentName:"tbody"},(0,l.mdx)("td",{parentName:"tr",align:null},"2"),(0,l.mdx)("td",{parentName:"tr",align:null},"CATALOG_ONLY"),(0,l.mdx)("td",{parentName:"tr",align:null},"This product appears in catalog listings, but not in searches.")),(0,l.mdx)("tr",{parentName:"tbody"},(0,l.mdx)("td",{parentName:"tr",align:null},"3"),(0,l.mdx)("td",{parentName:"tr",align:null},"SEARCH_ONLY"),(0,l.mdx)("td",{parentName:"tr",align:null},"This product appears in searches, but not catalog listings.")),(0,l.mdx)("tr",{parentName:"tbody"},(0,l.mdx)("td",{parentName:"tr",align:null},"4"),(0,l.mdx)("td",{parentName:"tr",align:null},"CATALOG_AND_SEARCH"),(0,l.mdx)("td",{parentName:"tr",align:null},"This product appears in catalog listings and searches. For most products, this is the default.")))),(0,l.mdx)("p",null,"In the following example, the ",(0,l.mdx)("inlineCode",{parentName:"p"},"TestConverterVisibility")," converter class updates the value of the ",(0,l.mdx)("inlineCode",{parentName:"p"},"visibility")," field to a string."),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-php"},"<?php\n/**\n * Copyright &copy; Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndeclare(strict_types=1);\n\nnamespace Magento\\AdobeCommerceEventsClient\\Event;\n\nuse Magento\\AdobeCommerceEventsClient\\Event\\Filter\\FieldConverterInterface;\n\nclass TestConverterVisibility implements FieldConverterInterface\n{\n    /**\n     * Method used to convert field value\n     *\n     * @param mixed $value\n     * @return mixed\n     */\n    public function convert(mixed $value, Event $event): mixed\n    {\n        return match ($value) {\n            '1' => 'NOT_VISIBLE_INDIVIDUALLY',\n            '2' => 'CATALOG_ONLY',\n            '3' => 'SEARCH_ONLY',\n            '4' => 'CATALOG_AND_SEARCH'\n        };\n    }\n}\n")),(0,l.mdx)("p",null,"The default payload for this event includes the following:"),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-json"},'{\n   "event":{\n      "data":{\n         "value":{\n            "visibility":"4",\n        }\n      }\n   }\n}\n')),(0,l.mdx)("p",null,"The converter changes the payload to:"),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-json"},'{\n   "event":{\n      "data":{\n         "value":{\n            "visibility":"CATALOG_AND_SEARCH",\n        }\n      }\n   }\n}\n')),(0,l.mdx)("h2",{id:"register-the-converter"},"Register the converter"),(0,l.mdx)("p",null,"You must configure a module's ",(0,l.mdx)("inlineCode",{parentName:"p"},"io_events.xml")," or root ",(0,l.mdx)("inlineCode",{parentName:"p"},"app/etc/io_events.xml")," file to update the required fields. You can also declare them in the system ",(0,l.mdx)("inlineCode",{parentName:"p"},"config.php")," file or add them when using the CLI to subscribe to an event."),(0,l.mdx)("h3",{id:"command-line"},"Command line"),(0,l.mdx)("p",null,"The ",(0,l.mdx)("a",{parentName:"p",href:"commands.md#subscribe-to-an-event"},(0,l.mdx)("inlineCode",{parentName:"a"},"bin/magento events:subscribe --fields")," command")," defines the fields and converters to include in the payload of a subscribed event. The example command adds the ",(0,l.mdx)("inlineCode",{parentName:"p"},"visibility")," field and provides the path to the converter class. You can specify multiple fields in the same request."),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-bash"},'bin/magento events:subscribe observer.catalog_product_save_after --fields="store_id" --fields=\'{"name":"visibility", "converter": "Magento\\AdobeCommerceEventsClient\\Event\\TestConverterVisibility"}\'`\n')),(0,l.mdx)("h3",{id:"configphp-file"},(0,l.mdx)("inlineCode",{parentName:"h3"},"config.php")," file"),(0,l.mdx)("p",null,"The following example ",(0,l.mdx)("inlineCode",{parentName:"p"},"config.php")," is the equivalent of the example ",(0,l.mdx)("inlineCode",{parentName:"p"},"bin/magento events:subscribe")," command in the ",(0,l.mdx)("strong",{parentName:"p"},"Command line")," example above."),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-php"},"'io_events' => [\n        'observer.catalog_product_save_after' => [\n            'fields' => [\n                'store_id',\n                [\n                    'name' => 'visibility',\n                    'converter' => 'Magento\\\\AdobeCommerceEventsClient\\\\Event\\\\TestConverterVisibility'\n                ]\n            ],\n            'enabled' => 1\n        ]\n ]       \n")),(0,l.mdx)("h3",{id:"configure-an-io_eventsxml-file"},"Configure an ",(0,l.mdx)("inlineCode",{parentName:"h3"},"io_events.xml")," file"),(0,l.mdx)("p",null,"The ",(0,l.mdx)("inlineCode",{parentName:"p"},"converter")," attribute of the ",(0,l.mdx)("inlineCode",{parentName:"p"},"field")," element defines the converter class that updates the event data field value for the specified event. Only one converter class can be defined per field."),(0,l.mdx)("p",null,"The following example updates the value of the field ",(0,l.mdx)("inlineCode",{parentName:"p"},"visibility")," present in the ",(0,l.mdx)("inlineCode",{parentName:"p"},"observer.catalog_product_save_after")," event payload using the ",(0,l.mdx)("inlineCode",{parentName:"p"},"TestConverterVisibility")," converter class."),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-xml"},'<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:module-commerce-events-client/etc/io_events.xsd">\n    <event name="observer.catalog_product_save_after" >\n        <fields>\n            <field name="visibility" converter="Magento\\AdobeCommerceEventsClient\\Event\\TestConverterVisibility"/>\n        </fields>\n    </event>\n</config>\n')))}p.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-events-convert-field-values-md-f2ea30079983b1466ba4.js.map