"use strict";(self.webpackChunkcommerce_extensibility=self.webpackChunkcommerce_extensibility||[]).push([[8227],{13405:function(e,t,a){a.r(t),a.d(t,{_frontmatter:function(){return i},default:function(){return s}});var n=a(87462),o=a(45987),l=(a(35776),a(3905)),r=a(91515);const d=["components"],i={},m={_frontmatter:i},p=r.Z;function s(e){let{components:t}=e,a=(0,o.Z)(e,d);return(0,l.mdx)(p,(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,l.mdx)("h1",{id:"create-conditional-webhooks"},"Create conditional webhooks"),(0,l.mdx)("p",null,"You may decide that you want to trigger a webhook only if its payload meets certain conditions. For example, you could decide to calculate taxes using a third-party service for specific postal codes only. If the postal code provided in the payload does not match the selected postal code, there is no value in triggering the webhook."),(0,l.mdx)("p",null,"A conditional webhook can significantly reduce the number of API calls, which reduces the waiting time for clients."),(0,l.mdx)("p",null,"Conditional webhooks can have one or more rules. Each rule contains the following:"),(0,l.mdx)("ul",null,(0,l.mdx)("li",{parentName:"ul"},(0,l.mdx)("p",{parentName:"li"},"The field to be evaluated. For nested fields, use the dot-separated format, such as ",(0,l.mdx)("inlineCode",{parentName:"p"},"data.order.product.id"),".")),(0,l.mdx)("li",{parentName:"ul"},(0,l.mdx)("p",{parentName:"li"},"An operator, which is represented as a comparison statement between the value supplied in the webhook payload and the threshold value."),(0,l.mdx)("p",{parentName:"li"},"The operator must be one of the following:"),(0,l.mdx)("table",{parentName:"li"},(0,l.mdx)("thead",{parentName:"table"},(0,l.mdx)("tr",{parentName:"thead"},(0,l.mdx)("th",{parentName:"tr",align:null},"Operator"),(0,l.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,l.mdx)("tbody",{parentName:"table"},(0,l.mdx)("tr",{parentName:"tbody"},(0,l.mdx)("td",{parentName:"tr",align:null},(0,l.mdx)("inlineCode",{parentName:"td"},"greaterThan")),(0,l.mdx)("td",{parentName:"tr",align:null},"Checks whether the value supplied in the payload of the webhook is greater than a specified value. Applicable for integer and float data types.")),(0,l.mdx)("tr",{parentName:"tbody"},(0,l.mdx)("td",{parentName:"tr",align:null},(0,l.mdx)("inlineCode",{parentName:"td"},"lessThan")),(0,l.mdx)("td",{parentName:"tr",align:null},"Checks whether the payload value is less than a specified value. Applicable for integer and float data types.")),(0,l.mdx)("tr",{parentName:"tbody"},(0,l.mdx)("td",{parentName:"tr",align:null},(0,l.mdx)("inlineCode",{parentName:"td"},"equal")),(0,l.mdx)("td",{parentName:"tr",align:null},"Checks whether the payload value matches the specified value. For Boolean data types, use ",(0,l.mdx)("inlineCode",{parentName:"td"},"1")," to compare to ",(0,l.mdx)("inlineCode",{parentName:"td"},"true")," and ",(0,l.mdx)("inlineCode",{parentName:"td"},"0")," to compare to ",(0,l.mdx)("inlineCode",{parentName:"td"},"false"),".")),(0,l.mdx)("tr",{parentName:"tbody"},(0,l.mdx)("td",{parentName:"tr",align:null},(0,l.mdx)("inlineCode",{parentName:"td"},"notEqual")),(0,l.mdx)("td",{parentName:"tr",align:null},"Checks whether the payload value does not match the specified value.")),(0,l.mdx)("tr",{parentName:"tbody"},(0,l.mdx)("td",{parentName:"tr",align:null},(0,l.mdx)("inlineCode",{parentName:"td"},"regex")),(0,l.mdx)("td",{parentName:"tr",align:null},"A regular expression that checks for matches. The specified value must be compatible with the ",(0,l.mdx)("a",{parentName:"td",href:"https://www.php.net/manual/en/function.preg-match.php"},"regular expression match"),".")),(0,l.mdx)("tr",{parentName:"tbody"},(0,l.mdx)("td",{parentName:"tr",align:null},(0,l.mdx)("inlineCode",{parentName:"td"},"in")),(0,l.mdx)("td",{parentName:"tr",align:null},"Checks whether the payload value is one of multiple specified values. The value must be a comma-separated list. You do not need to provide additional escape characters.")),(0,l.mdx)("tr",{parentName:"tbody"},(0,l.mdx)("td",{parentName:"tr",align:null},(0,l.mdx)("inlineCode",{parentName:"td"},"isEmpty")),(0,l.mdx)("td",{parentName:"tr",align:null},"Checks whether the payload value is empty.")),(0,l.mdx)("tr",{parentName:"tbody"},(0,l.mdx)("td",{parentName:"tr",align:null},(0,l.mdx)("inlineCode",{parentName:"td"},"notEmpty")),(0,l.mdx)("td",{parentName:"tr",align:null},"Checks whether the payload value is not empty."))))),(0,l.mdx)("li",{parentName:"ul"},(0,l.mdx)("p",{parentName:"li"},"The value to compare against. When you assign the ",(0,l.mdx)("inlineCode",{parentName:"p"},"regex")," operator, you must delimit the regular expression value with valid characters, such as forward slashes (/). For example, ",(0,l.mdx)("inlineCode",{parentName:"p"},"/^TV .*/i"),", which checks whether the string starts with ",(0,l.mdx)("inlineCode",{parentName:"p"},"TV"),", ignoring the case of the letters."))),(0,l.mdx)("h2",{id:"define-conditional-webhooks-in-webhooksxml"},"Define conditional webhooks in ",(0,l.mdx)("inlineCode",{parentName:"h2"},"webhooks.xml")),(0,l.mdx)("p",null,"The following example creates and registers a conditional webhook for the event ",(0,l.mdx)("inlineCode",{parentName:"p"},"plugin.magento.tax.api.tax_calculation.calculate_tax"),". The webhook will be only triggered when all of the conditions are true:"),(0,l.mdx)("ul",null,(0,l.mdx)("li",{parentName:"ul"},"The value of ",(0,l.mdx)("inlineCode",{parentName:"li"},".quoteDetails.shipping_address.country_id")," must be equal to ",(0,l.mdx)("inlineCode",{parentName:"li"},"US"),"."),(0,l.mdx)("li",{parentName:"ul"},"The ",(0,l.mdx)("inlineCode",{parentName:"li"},"quoteDetails.billing_address.postcode")," must begin with ",(0,l.mdx)("inlineCode",{parentName:"li"},"123"),".")),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-xml"},'<method name="plugin.magento.tax.api.tax_calculation.calculate_tax" type="after">\n   <hooks>\n      <batch>\n         <hook name="update_order" url="{env:APP_URL}/calculate-taxes" method="POST" timeout="5000" softTimeout="1000" priority="300" required="false" fallbackErrorMessage="The taxes can not be calculated">\n            <fields>\n               <field name="quoteDetails" />\n               <field name="storeId" />\n            </fields>\n            <rules>\n               <rule field="quoteDetails.shipping_address.country_id" operator="equal" value="US" />\n               <rule field="quoteDetails.billing_address.postcode" operator="regex" value="/^123/" />\n            </rules>\n         </hook>\n      </batch>\n   </hooks>\n</method>\n')),(0,l.mdx)("p",null,"The following example sends a webhook to a third-party service when the product short description is empty. The service generates the text for the description. The webhook returns the operation with information to update the product short description. As a result, the webhook will not be triggered again for the same product."),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-xml"},'       <method name="observer.catalog_product_save_before" type="before">\n       <hooks>\n           <batch>\n               <hook name="generate_description" url="{env:APP_URL}/generate-product-description" timeout="5000" softTimeout="1000" priority="300" required="true" fallbackErrorMessage="The product could not be updated">\n                   <fields>\n                       <field name="product.name" source="data.product.name" />\n                       <field name="product.category_ids" source="data.product.category_ids" />\n                       <field name="product.sku" source="data.product.sku" />\n                   </fields>\n                   <rules>\n                       <rule field="product.short_description" operation="isEmpty" />\n                   </rules>\n               </hook>\n           </batch>\n       </hooks>\n   </method>\n')),(0,l.mdx)("h2",{id:"command-line"},"Command line"),(0,l.mdx)("p",null,"You can use the ",(0,l.mdx)("inlineCode",{parentName:"p"},"bin/magento webhooks:list")," command to display the contents of your subscribed webhooks, including rules information."))}s.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-webhooks-conditional-webhooks-md-f4788e98c6d3594b9d2a.js.map